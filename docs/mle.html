<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Visual Statistics - 5&nbsp; Maximum Likelihood Estimation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./anova.html" rel="next">
<link href="./loess.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<meta name="shinylive:serviceworker_dir" content=".">
<script src="site_libs/quarto-contrib/shinylive-0.2.3/shinylive/load-shinylive-sw.js" type="module"></script>
<script src="site_libs/quarto-contrib/shinylive-0.2.3/shinylive/run-python-blocks.js" type="module"></script>
<link href="site_libs/quarto-contrib/shinylive-0.2.3/shinylive/shinylive.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/shinylive-quarto-css/shinylive-quarto.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<link href="site_libs/htmltools-fill-0.5.8/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.32/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./mle.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Maximum Likelihood Estimation</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Visual Statistics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/jbryer/VisualStats/tree/main/book/" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./variance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Variance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Distributions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./loess.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Loess Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mle.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Maximum Likelihood Estimation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Analysis of Variance (ANOVA)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Maximum Likelihood Estimation</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><a href="https://en.wikipedia.org/wiki/Maximum_likelihood_estimation">Maximum Likelihood Estimation</a> (MLE) is an important procedure for estimating parameters in statistical models. It is often first encountered when modeling a dichotomous outcome variable vis-à-vis logistic regression. However, it is the backbone of <a href="https://en.wikipedia.org/wiki/Generalized_linear_model">generalized linear models</a> (GLM) which allow for error distribution models other than the normal distribution. Most introductions to MLE rely on mathematical notation that for many students is opaque and hinders learning how this method works. The document outlines an approach to understanding MLE that relies on visualizations and mathematical notation is only used when necessary.</p>
<p>We will begin with a typical bivariate regression using the <code>mtcars</code> data set where we wish to predict <code>mpg</code> (miles per gallon) from <code>wt</code> (weight in 1,000 lbs). Figure 1 is a scatter plot showing the relationship between these two variables.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mle_files/figure-html/mlescatterplot1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 1. Scatter plot of weight versus miles per gallan.</figcaption>
</figure>
</div>
</div>
</div>
<p>Our goal is to estimate</p>
<p><span class="math display">\[Y_{mpg} = \beta_{wt} X + e\]</span> where <span class="math inline">\(\beta_{wt}\)</span> is the slope and <span class="math inline">\(e\)</span> is the intercept.</p>
<section id="ordinary-least-squares" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="ordinary-least-squares"><span class="header-section-number">5.1</span> Ordinary Least Squares</h2>
<p>With ordinary least squares (OLS) regression our goal is to minimize the residual sum of squares (RSS):</p>
<p><span class="math display">\[RSS=\sum^{n}_{i=1} \left( y_{i}-f(x_{i})\right)^{2}\]</span></p>
<p>where <span class="math inline">\(y_i\)</span> is the variable to be predicted, <span class="math inline">\(f(x_i)\)</span> is the predicted value of <span class="math inline">\(y_i\)</span>, and <span class="math inline">\(n\)</span> is the sample size. Figure 2 superimposes the residuals on the scatter plot. By squaring the length of each of those lines we accomplish two things: 1) we make all the values to be summed positive (i.e.&nbsp;a line that fits all the data perfectly will have a RSS = 0) and 2) points that fall further from the regression line contribute more (geometrically more) to the RSS then points close to the regression line.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mle_files/figure-html/mlescatterresiduals-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 2 Scatter plot with residuals.</figcaption>
</figure>
</div>
</div>
</div>
<p>The basic properties we know about regression are:</p>
<ul>
<li>The correlation measures the strength of the relationship between x and y (see <a href="https://shiny.rit.albany.edu/stat/rectangles/">this shiny app</a> for an excellent visual overview of correlations).</li>
<li>The correlation ranges between -1 and 1.</li>
<li>The mean of x and y must fall on the line.</li>
<li>The slope of a line is defined as the change in y over the change in x (<span class="math inline">\(\frac{\Delta y}{\Delta x}\)</span>). For regression use the ration of the standard deviations such that the correlation is defined as <span class="math inline">\(m = r \frac{s_y}{s_x}\)</span> where <span class="math inline">\(m\)</span> is the slope, <span class="math inline">\(r\)</span> is the correlation, and <span class="math inline">\(s\)</span> is the sample standard deviation.</li>
</ul>
<p>We can easily calculate the RSS for various correlations (<span class="math inline">\(r\)</span>) ranging between -1 and 1. Figure 3 visualizes the RSS.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> mtcars<span class="sc">$</span>mpg</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> mtcars<span class="sc">$</span>wt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>mean.y <span class="ot">&lt;-</span> <span class="fu">mean</span>(y)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>mean.x <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>sd.y <span class="ot">&lt;-</span> <span class="fu">sd</span>(y)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>sd.x <span class="ot">&lt;-</span> <span class="fu">sd</span>(x)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>ols <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">r =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.025</span>),            <span class="co"># Correlation</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">m =</span> r <span class="sc">*</span> (sd.y <span class="sc">/</span> sd.x),                 <span class="co"># Slope</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">b =</span> mean.y <span class="sc">-</span> m <span class="sc">*</span> mean.x                <span class="co"># Intercept</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ss =</span> <span class="fu">sum</span>((y <span class="sc">-</span> (m <span class="sc">*</span> x <span class="sc">+</span> b))<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> <span class="co"># Sum of squares residuals</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(ols) <span class="sc">%&gt;%</span> <span class="fu">formatRound</span>(<span class="at">columns =</span> <span class="fu">names</span>(ols), <span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item" id="htmlwidget-852f153ef9f44653221c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-852f153ef9f44653221c">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81"],[-1,-0.975,-0.95,-0.925,-0.9,-0.875,-0.85,-0.825,-0.8,-0.775,-0.75,-0.725,-0.7,-0.675,-0.6499999999999999,-0.625,-0.6,-0.575,-0.55,-0.5249999999999999,-0.5,-0.475,-0.45,-0.4249999999999999,-0.3999999999999999,-0.375,-0.35,-0.325,-0.2999999999999999,-0.2749999999999999,-0.25,-0.225,-0.2,-0.1749999999999999,-0.1499999999999999,-0.125,-0.09999999999999998,-0.07499999999999996,-0.04999999999999993,-0.02499999999999991,0,0.02500000000000013,0.05000000000000004,0.07499999999999996,0.1000000000000001,0.125,0.1500000000000001,0.175,0.2000000000000002,0.2250000000000001,0.25,0.2750000000000001,0.3,0.3250000000000002,0.3500000000000001,0.375,0.4000000000000001,0.425,0.4500000000000002,0.4750000000000001,0.5,0.5250000000000001,0.55,0.5750000000000002,0.6000000000000001,0.625,0.6500000000000001,0.675,0.7000000000000002,0.7250000000000001,0.75,0.7750000000000001,0.8,0.8250000000000002,0.8500000000000001,0.875,0.9000000000000001,0.925,0.9500000000000002,0.9750000000000001,1],[-6.159642501848258,-6.005651439302051,-5.851660376755845,-5.697669314209639,-5.543678251663432,-5.389687189117225,-5.235696126571019,-5.081705064024812,-4.927714001478606,-4.7737229389324,-4.619731876386194,-4.465740813839987,-4.31174975129378,-4.157758688747574,-4.003767626201367,-3.849776563655161,-3.695785501108955,-3.541794438562748,-3.387803376016542,-3.233812313470335,-3.079821250924129,-2.925830188377923,-2.771839125831716,-2.617848063285509,-2.463857000739303,-2.309865938193097,-2.15587487564689,-2.001883813100684,-1.847892750554477,-1.69390168800827,-1.539910625462064,-1.385919562915858,-1.231928500369651,-1.077937437823445,-0.9239463752772381,-0.7699553127310322,-0.6159642501848257,-0.4619731876386191,-0.3079821250924125,-0.1539910625462059,0,0.1539910625462073,0.3079821250924132,0.4619731876386191,0.6159642501848264,0.7699553127310322,0.9239463752772396,1.077937437823445,1.231928500369653,1.385919562915858,1.539910625462064,1.693901688008272,1.847892750554478,2.001883813100685,2.155874875646891,2.309865938193097,2.463857000739304,2.61784806328551,2.771839125831717,2.925830188377923,3.079821250924129,3.233812313470336,3.387803376016542,3.54179443856275,3.695785501108955,3.849776563655161,4.003767626201369,4.157758688747574,4.311749751293782,4.465740813839988,4.619731876386194,4.773722938932401,4.927714001478606,5.081705064024814,5.235696126571019,5.389687189117225,5.543678251663433,5.697669314209639,5.851660376755846,6.005651439302052,6.159642501848258],[39.90773483907131,39.41230709309453,38.91687934711774,38.42145160114096,37.92602385516417,37.43059610918739,36.93516836321061,36.43974061723382,35.94431287125705,35.44888512528026,34.95345737930348,34.4580296333267,33.96260188734991,33.46717414137314,32.97174639539635,32.47631864941957,31.98089090344278,31.485463157466,30.99003541148922,30.49460766551243,29.99917991953565,29.50375217355887,29.00832442758209,28.51289668160531,28.01746893562852,27.52204118965174,27.02661344367495,26.53118569769817,26.03575795172139,25.54033020574461,25.04490245976783,24.54947471379104,24.05404696781426,23.55861922183748,23.06319147586069,22.56776372988391,22.07233598390713,21.57690823793035,21.08148049195356,20.58605274597678,20.090625,19.59519725402322,19.09976950804643,18.60434176206965,18.10891401609287,17.61348627011608,17.1180585241393,16.62263077816252,16.12720303218573,15.63177528620895,15.13634754023217,14.64091979425539,14.14549204827861,13.65006430230182,13.15463655632504,12.65920881034826,12.16378106437147,11.66835331839469,11.17292557241791,10.67749782644113,10.18207008046435,9.68664233448756,9.191214588510778,8.695786842533993,8.200359096557214,7.704931350580432,7.209503604603645,6.714075858626867,6.218648112650081,5.723220366673299,5.227792620696517,4.732364874719734,4.236937128742953,3.741509382766164,3.246081636789388,2.750653890812607,2.25522614483582,1.75979839885904,1.264370652882253,0.7689429069054725,0.2735151609286923],[298.0435737295439,291.2962638784929,285.9565130118168,282.0243211295156,279.4996882315895,278.3826143180384,278.6730993888623,280.3711434440611,283.4767464836352,287.9899085075841,293.910629515908,301.2389095086069,309.9747484856808,320.1181464471298,331.6691033929535,344.6276193231524,358.9936942377265,374.7673281366751,391.948521019999,410.537272887698,430.533583739772,451.9374535762206,474.7488823970448,498.9678702022436,524.5944169918176,551.6285227657662,580.0701875240903,609.9194112667891,641.1761939938633,673.8405357053122,707.9124364011359,743.3918960813348,780.2789147459085,818.5734923948578,858.2756290281815,899.3853246458805,941.9025792479543,985.8273928344033,1031.159765405227,1077.899696960426,1126.0471875,1175.602237023949,1226.564845532273,1278.935013024972,1332.712739502045,1387.898024963494,1444.490869409318,1502.491272839517,1561.899235254092,1622.71475665304,1684.937837036364,1748.568476404063,1813.606674756137,1880.052432092586,1947.90574841341,2017.166623718609,2087.835058008182,2159.911051282131,2233.394603540456,2308.285714783154,2384.584385010229,2462.290614221678,2541.4044024175,2621.9257495977,2703.854655762274,2787.191120911223,2871.935145044548,2958.086728162245,3045.645870264319,3134.612571350768,3224.986831421591,3316.768650476791,3409.958028516365,3504.554965540315,3600.559461548638,3697.971516541337,3796.79113051841,3897.01830347986,3998.653035425684,4101.695326355883,4206.145176270456]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>r<\/th>\n      <th>m<\/th>\n      <th>b<\/th>\n      <th>ss<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"targets":1,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 3, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"r","targets":1},{"name":"m","targets":2},{"name":"b","targets":3},{"name":"ss","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render"],"jsHooks":[]}</script>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mle_files/figure-html/mlesumsquares-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 3. Residual sum of squares.</figcaption>
</figure>
</div>
</div>
</div>
<p>The correlation with the correlation the resulted in the smallest RSS is -0.875.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ols <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(ss <span class="sc">==</span> <span class="fu">min</span>(ss)) <span class="co"># Select the row with the smallest sum of squares residuals</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       r         m       b       ss
1 -0.875 -5.389687 37.4306 278.3826</code></pre>
</div>
</div>
<p>Calculating the correlation in R gives us -0.8676594 and the slope is -5.3444716 which is close to our estimate here. We could get a more accurate result if we tried smaller steps in the correlation (see the <code>by</code> parameter in the <code>seq</code> function above).</p>
</section>
<section id="minimizing-rss-algorithmically" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="minimizing-rss-algorithmically"><span class="header-section-number">5.2</span> Minimizing RSS Algorithmically</h2>
<p>This approach works well here because the correlation is bounded between -1 and 1 and we can easily calculate the RSS for a bunch of possible correlations. However, there are more efficient ways of finding the correlation that minimizes the RSS than trying correlations equally distributed across the possible range. For example, consider the following simple algorithm:</p>
<ol type="1">
<li>Calculate the RSS for <span class="math inline">\(r = 0\)</span>.</li>
<li>Calculate the RSS for <span class="math inline">\(r = 0.5\)</span> If <span class="math inline">\(RSS_{0.5} &lt; RSS_{0}\)</span> then calculate the RSS with <span class="math inline">\(r = 0.75\)</span>, else calculate the RSS with <span class="math inline">\(r = -0.5%\)</span></li>
</ol>
<p>We can repeat this procedure, essentially halving the distance in each iteration until we find a sufficiently small RSS. This process is, in essence, the idea of numerical optimization procedures. In R, the <code>optim</code> function implements the <a href="https://en.wikipedia.org/wiki/Nelder–Mead_method">Nedler-Mead</a> (Nedler &amp; Mead, 1965) and <a href="https://en.wikipedia.org/wiki/Limited-memory_BFGS">Limited Memory BFGS</a> (Byrd et al, 1995) methods for optimizing a set of parameters. The former is the default but we will use the latter throughout this document since it allows for specifying bounds for certain parameters (e.g.&nbsp;only consider positive values). The details of <em>how</em> the algorithm works is beyond the scope of this article (see this <a href="https://www.benfrederickson.com/numerical-optimization/">interactive tutoral</a> by Ben Frederickson for a good introduction), instead we will focus on <em>what</em> the algorithm does. To begin, we must define a function that calculates a metric for which the optimizer is going to minimize (or maximize). Let’s start with RSS:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>residual_sum_squares <span class="ot">&lt;-</span> <span class="cf">function</span>(parameters, predictor, outcome) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">&lt;-</span> parameters[<span class="dv">1</span>] <span class="co"># Intercept</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">&lt;-</span> parameters[<span class="dv">2</span>] <span class="co"># beta coefficient</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    predicted <span class="ot">&lt;-</span> a <span class="sc">+</span> b <span class="sc">*</span> predictor</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    residuals <span class="ot">&lt;-</span> outcome <span class="sc">-</span> predicted</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    ss <span class="ot">&lt;-</span> <span class="fu">sum</span>(residuals<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(ss)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>parameters</code> is a vector of the parameters the algorithm is going to minimize (or maximize). Here, these will be the slope and intercept. The <code>predictor</code> and <code>outcome</code> are parameters passed through from the <code>...</code> parameter on the <code>optim</code> function and are necessary for us to calculate the RSS. We can now get the RSS for any set of parameters.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residual_sum_squares</span>(<span class="fu">c</span>(<span class="dv">37</span>, <span class="sc">-</span><span class="dv">5</span>), mtcars<span class="sc">$</span>wt, mtcars<span class="sc">$</span>mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 303.5247</code></pre>
</div>
</div>
<p><strong>Small Digression</strong> In order to explore each step of the algorithm, we need to wrap the <code>optim</code> function to capture the parameters and output of the function. The <code>optim_save</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> function will add two elements to the returned list: <code>iterations</code> is the raw list of the parameters and output saved and <code>iterations_df</code> is a <code>data.frame</code> containing the same data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>optim_save <span class="ot">&lt;-</span> <span class="cf">function</span>(par, fn, ...) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    iterations <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    wrap_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(parameters, ...) {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        n <span class="ot">&lt;-</span> <span class="fu">length</span>(iterations)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        result <span class="ot">&lt;-</span> <span class="fu">fn</span>(parameters, ...)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        iterations[[n <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;&lt;-</span> <span class="fu">c</span>(parameters, result)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(result)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    optim_out <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">optim</span>(par, wrap_fun, ...)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    optim_out<span class="sc">$</span>iterations <span class="ot">&lt;-</span> iterations</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    optim_out<span class="sc">$</span>iterations_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(rbind, iterations))</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(optim_out<span class="sc">$</span>iterations_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">'Param'</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(par)), <span class="st">'Result'</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    optim_out<span class="sc">$</span>iterations_df<span class="sc">$</span>Iteration <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(optim_out<span class="sc">$</span>iterations_df)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(optim_out)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now call the <code>optim_save</code> function with our <code>residual_sum_squares</code> function. We initialize the algorithm with two random values for the intercept and slope, respectively. Note that we are using Broyden, Fletcher, Goldfarb, and Shanno optimization method which allows for the specification of bounds on the parameter estimates which we will use later.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>optim.rss <span class="ot">&lt;-</span> <span class="fu">optim_save</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">par =</span> <span class="fu">runif</span>(<span class="dv">2</span>),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fn =</span> residual_sum_squares, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">predictor =</span> mtcars<span class="sc">$</span>wt,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> mtcars<span class="sc">$</span>mpg</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>par</code> parameter provides the final parameter estimates.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>optim.rss<span class="sc">$</span>par</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 37.285116 -5.344469</code></pre>
</div>
</div>
<p>We can see that the parameters are accurate to at least four decimal places to the OLS method used by the <code>lm</code> function.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>lm.out <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> wt, <span class="at">data =</span> mtcars)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>lm.out<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)          wt 
  37.285126   -5.344472 </code></pre>
</div>
</div>
<p>It took the <code>optim</code> function 65 iterations to find the optimal set of parameters that minimized the RSS. Figure 4 shows the value of the parameters (i.e.&nbsp;intercept and slope) and the RSS for each iteration.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> optim.rss<span class="sc">$</span>iterations_df</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Intercept'</span>, <span class="st">'Slope'</span>, <span class="st">'ResidualSumSquares'</span>, <span class="st">'Iteration'</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">melt</span>(<span class="at">id.var =</span> <span class="st">'Iteration'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Iteration, <span class="at">y =</span> value, <span class="at">color =</span> variable)) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_path</span>() <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> variable, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">'Iteration'</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">''</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'none'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mle_files/figure-html/mleoptimiationplot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 4. Output of the optimizaiton procedure at each iteration.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="likelihood" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="likelihood"><span class="header-section-number">5.3</span> Likelihood</h2>
<p>Now that we have laid the groundwork for finding parameters algorithmically, we need to introduce another way of evaluating how well parameters <em>fit</em> the data, namely the likelihood. First, let’s revisit what we are doing in OLS. Figure 5 is a scatter plot of our observations, the OLS regression line in blue, and one observation highlighted in red with the residual as a red line. With OLS, we square the residual for every observation, thereby making all values positive, and summing them. There is, however, another way of estimating fit that doesn’t rely on the residuals.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mle_files/figure-html/mlescatterplot2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 5. Scatter plot with residuals for one observation.</figcaption>
</figure>
</div>
</div>
</div>
<p>We often think of probabilities as the areas under a fixed distribution. For example, the first car in <code>mtcars</code> is Mazda RX4 with an average miles per gallon of 21 and weighs 2620lbs. The probability of a car with a miles per gallon less than Mazda RX4 given the data we have in <code>mtcars</code> is 0.5599667 and is depicted in Figure 6.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mle_files/figure-html/mleprobplot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 6. Probability distribution of miles per gallan.</figcaption>
</figure>
</div>
</div>
</div>
<p>For probabilities, we are working with a fixed distribution, that is:</p>
<p><span class="math display">\[pr(data\ |\ distribution)\]</span> The likelihood are the y-axis values (i.e.&nbsp;density) for fixed data points with distributions that can move, that is:</p>
<p><span class="math display">\[L(distribution\ |\ data)\]</span> The likelihood is the height of the density function. Figure 7 depicts two likelihood for two observations. The mean of each distribution is equal to <span class="math inline">\(\beta_{wt} X + e\)</span> and the intercept (also known as the error term) defines the standard deviation of the distribution.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mle_files/figure-html/mleanimation1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 7. Likelihood of a car having the observed mpg given the model parameters for two observations.</figcaption>
</figure>
</div>
</div>
</div>
<p>We can then calculate the likelihood for each observation in our data. Unlike OLS, we now want to <em>maximize</em> the sum of these values. Also, we are going to use the log of the likelihood so we can add them instead of multiplying. We can now define our log likelihood function:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>loglikelihood <span class="ot">&lt;-</span> <span class="cf">function</span>(parameters, predictor, outcome) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">&lt;-</span> parameters[<span class="dv">1</span>]     <span class="co"># intercept</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">&lt;-</span> parameters[<span class="dv">2</span>]     <span class="co"># slope / beta coefficient</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    sigma <span class="ot">&lt;-</span> parameters[<span class="dv">3</span>] <span class="co"># error</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    ll.vec <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(outcome, a <span class="sc">+</span> b <span class="sc">*</span> predictor, sigma, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sum</span>(ll.vec))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that we have to estimate a third parameter, sigma, which is the error term and defines the standard deviation for the normal distribution for estimating the likelihood. This is connected to the distribution of the residuals as we will see later. We can now calculate the log-likelihood for any combination of parameters.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loglikelihood</span>(<span class="fu">c</span>(<span class="dv">37</span>, <span class="sc">-</span><span class="dv">5</span>, <span class="fu">sd</span>(mtcars<span class="sc">$</span>mpg)),</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">predictor =</span> mtcars<span class="sc">$</span>wt,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">outcome =</span> mtcars<span class="sc">$</span>mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -91.06374</code></pre>
</div>
</div>
</section>
<section id="maximum-likelihood-estimation" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="maximum-likelihood-estimation"><span class="header-section-number">5.4</span> Maximum Likelihood Estimation</h2>
<p>We can now use the <code>optim_save</code> function to find the parameters that <em>maximize</em> the log-likelihood. Note two important parameter changes:</p>
<ol type="1">
<li>We are specifying the <code>lower</code> parameter so that the algorithm will not try negative values for sigma since the variance cannot be negative.</li>
<li>The value for the <code>control</code> parameter indicates that we wish to maximize the values instead of minimizing (which is the default).</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>optim.ll <span class="ot">&lt;-</span> <span class="fu">optim_save</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">runif</span>(<span class="dv">3</span>),                     <span class="co"># Random initial values</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    loglikelihood,                <span class="co"># Log-likelihood function</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">1</span>.e<span class="dv">-5</span>), <span class="co"># The lower bounds for the values, note sigma (error), cannot be negative</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">list</span>(<span class="at">fnscale =</span> <span class="sc">-</span><span class="dv">1</span>), <span class="co"># Indicates that the maximum is desired rather than the minimum</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">predictor =</span> mtcars<span class="sc">$</span>wt,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> mtcars<span class="sc">$</span>mpg</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can get our results and compare them to the results of the <code>lm</code> function and find that they match to at least four decimal places.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>optim.ll<span class="sc">$</span>par[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 37.285114 -5.344468</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>lm.out<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)          wt 
  37.285126   -5.344472 </code></pre>
</div>
</div>
<p>Figure 8 shows the estimated regression line for each iteration of the optimization procedure (on the left; OLS regression line in blue; MLE regression line in black) with the estimated parameters and log-likelihood for all iterations on the left.</p>
<p>Figure 9 superimposes the normal distribution from which the log-likelihood is determined. The distribution is centered on <span class="math inline">\(\hat{y}\)</span>. The height of the distribution (i.e.&nbsp;density) at <span class="math inline">\(y\)</span> is the likelihood. We take the log of this value to get the log-likelihood. These log-likelihoods are calculated for each observation and summed. Maximum likelihood estimation is attempting to find the parameters (i.e.&nbsp;slope and intercept) that maximizes the log-likelihood.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>VisualStats<span class="sc">::</span><span class="fu">plot_likelihood</span>(<span class="at">x =</span> mtcars<span class="sc">$</span>wt, </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">y =</span> mtcars<span class="sc">$</span>mpg,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">pt =</span> <span class="dv">2</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">intercept =</span> optim.ll<span class="sc">$</span>par[<span class="dv">1</span>],</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">slope =</span> optim.ll<span class="sc">$</span>par[<span class="dv">2</span>],</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sigma =</span> optim.ll<span class="sc">$</span>par[<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mle_files/figure-html/mleplotlikelihood-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 9. Likelihood for one observeration superimposed on scatter plot.</figcaption>
</figure>
</div>
</div>
</div>
<p>Figure 10 depicts the likelihoods for the first 16 observations.</p>
<div class="cell" data-layout-align="center" data-hash="mle_cache/html/mleanimation3_7ba1785d1d014ec3530f89d45ab9856a">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> optim.ll<span class="sc">$</span>iterations_df</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Intercept'</span>, <span class="st">'Slope'</span>, <span class="st">'Sigma'</span>, <span class="st">'LogLikelihood'</span>, <span class="st">'Iteration'</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Iteration <span class="sc">==</span> <span class="fu">nrow</span>(df))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>nplots <span class="ot">&lt;-</span> <span class="dv">16</span> <span class="co">#nrow(mtcars)</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(nplots, <span class="fu">nrow</span>(mtcars))) {</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">&lt;-</span> tmp[<span class="dv">1</span>,]<span class="sc">$</span>Intercept</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">&lt;-</span> tmp[<span class="dv">1</span>,]<span class="sc">$</span>Slope</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    sigma <span class="ot">&lt;-</span> tmp[<span class="dv">1</span>,]<span class="sc">$</span>Sigma</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    predictor <span class="ot">&lt;-</span> mtcars<span class="sc">$</span>wt[i]</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    predicted.out <span class="ot">&lt;-</span> a <span class="sc">+</span> b <span class="sc">*</span> predictor</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    outcome <span class="ot">&lt;-</span> mtcars<span class="sc">$</span>mpg[i]</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(outcome, predicted.out, sigma)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    plots[[i]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">n =</span> <span class="dv">101</span>,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> predicted.out, <span class="at">sd =</span> sigma)) <span class="sc">+</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">'segment'</span>, <span class="at">x =</span> outcome, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> outcome, <span class="at">yend =</span> d, <span class="at">color =</span> <span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">'point'</span>, <span class="at">x =</span> outcome, <span class="at">y =</span> d, <span class="at">color =</span> <span class="st">'red'</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="fu">min</span>(mtcars<span class="sc">$</span>mpg, predicted.out <span class="sc">-</span> <span class="dv">3</span> <span class="sc">*</span> sigma),</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>               <span class="fu">max</span>(mtcars<span class="sc">$</span>mpg, predicted.out <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> sigma))) <span class="sc">+</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ylab</span>(<span class="st">''</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">row.names</span>(mtcars)[i])</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> plots)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mle_files/figure-html/mleanimation3-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 10. Likelihoods of the first 16 observations for the final parameter estimates.</figcaption>
</figure>
</div>
</div>
</div>
<p>With MLE we need to estimate what is often referred to as the error term, or as we saw above is the standard deviation of the normal distribution from which we are estimating the likelihood from. In Figure 9 notice that the normal distribution id drawn vertically. This is because the likelihood is estimated from the error, or the residuals. In OLS we often report the root-mean-square deviation (RMSD, or root-mean-square error, RMSE). The RMSD is the standard deviation of the residuals:</p>
<p><span class="math display">\[RMSD\  =\  \sqrt{\frac{\sum^{N}_{i=1} (x_{i}-\hat{x_{i}} )^{2}}{N} }\]</span> Where <span class="math inline">\(i\)</span> is the observation, <span class="math inline">\(x_i\)</span> is the observed value, <span class="math inline">\(\hat{x_i}\)</span> is the estimated (predicted) value, and <span class="math inline">\(N\)</span> is the sample size. Below, we see that the numerical optimizer matches the RMSD within a rounding error.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>optim.ll<span class="sc">$</span>par[<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.949164</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">sum</span>(<span class="fu">resid</span>(lm.out)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">nrow</span>(mtcars))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.949163</code></pre>
</div>
</div>
</section>
<section id="generalized-linear-models" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="generalized-linear-models"><span class="header-section-number">5.5</span> Generalized Linear Models</h2>
<p>Generalized linear models (GLM) are a generalization of OLS that allows for the response variables (i.e.&nbsp;dependent variables) to have an error distribution that is not distributed normally. All generalized linear models have the following three characteristics:</p>
<ol type="1">
<li>A probability distribution describing the outcome variable .</li>
<li>A linear model<br>
<span class="math inline">\(\eta = \beta_0+\beta_1 X_1 + \cdots + \beta_n X_n\)</span>.</li>
<li>A link function that relates the linear model to the parameter of the outcome distribution<br>
<span class="math inline">\(g(p) = \eta\)</span> or <span class="math inline">\(p = g^{-1}(\eta)\)</span>.</li>
</ol>
<p>We can estimate GLMs using MLE as described above. What will change is the log-likelihood function.</p>
</section>
<section id="logistic-regression" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="logistic-regression"><span class="header-section-number">5.6</span> Logistic Regression</h2>
<p>Logistic regression is a GLM used to model a binary categorical variable using numerical and categorical predictors. We assume a binomial distribution produced the outcome variable and we therefore want to model <em>p</em> the probability of success for a given set of predictors. Instead of fitting a line (or a plane for two predictors, etc. for higher dimensions) we wish to fit the data to the logistic function which is defined as:</p>
<p><span class="math display">\[ \sigma \left( t \right) =\frac { { e }^{ t } }{ { e }^{ t }+1 } =\frac { 1 }{ 1+{ e }^{ -t } }  \]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>logistic <span class="ot">&lt;-</span> <span class="cf">function</span>(t) { </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>t))) </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_function</span>(<span class="at">fun =</span> logistic, <span class="at">n =</span> <span class="dv">101</span>) <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">'x'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mle_files/figure-html/mlelogisticurve-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 11. Logistic curve</figcaption>
</figure>
</div>
</div>
</div>
<p>To finish specifying the Logistic model we just need to establish a reasonable link function that connects <span class="math inline">\(\eta\)</span> to <span class="math inline">\(p\)</span>. There are a variety of options but the most commonly used is the logit function which is specified as:</p>
<p><span class="math display">\[logit(p) = \log\left(\frac{p}{1-p}\right),\text{ for $0\le p \le 1$}\]</span></p>
<p>We can specify <em>t</em> as a linear combination of our predictors (independent variables).</p>
<p><span class="math display">\[ t = \beta_0 + \beta_1 x \]</span></p>
<p>The logistic function can now be rewritten as:</p>
<p><span class="math display">\[ F\left( x \right) =\frac { 1 }{ 1+{ e }^{ -\left( { \beta  }_{ 0 }+\beta _{ 1 }x \right)  } } \]</span></p>
<p>Consider the following data set where we wish to predict whether a student will pass an exam based upon the number of hours they studied.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>study <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">Hours=</span><span class="fu">c</span>(<span class="fl">0.50</span>,<span class="fl">0.75</span>,<span class="fl">1.00</span>,<span class="fl">1.25</span>,<span class="fl">1.50</span>,<span class="fl">1.75</span>,<span class="fl">1.75</span>,<span class="fl">2.00</span>,<span class="fl">2.25</span>,<span class="fl">2.50</span>,<span class="fl">2.75</span>,<span class="fl">3.00</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>            <span class="fl">3.25</span>,<span class="fl">3.50</span>,<span class="fl">4.00</span>,<span class="fl">4.25</span>,<span class="fl">4.50</span>,<span class="fl">4.75</span>,<span class="fl">5.00</span>,<span class="fl">5.50</span>),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Pass=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mle_files/figure-html/mlestudyboxplot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 12. Boxplot of hours studied by passing.</figcaption>
</figure>
</div>
</div>
</div>
<p>First, we need to define logit function and the log-likelihood function that will be used by the <code>optim</code> function. Instead of using the normal distribution as above (using the <code>dnorm</code> function), we are using a binomial distribution and the logit to link the linear combination of predictors.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>logit <span class="ot">&lt;-</span> <span class="cf">function</span>(x, beta0, beta1) {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>( <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>beta0 <span class="sc">-</span> beta1 <span class="sc">*</span> x)) )</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>loglikelihood.binomial <span class="ot">&lt;-</span> <span class="cf">function</span>(parameters, predictor, outcome) {</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">&lt;-</span> parameters[<span class="dv">1</span>] <span class="co"># Intercept</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">&lt;-</span> parameters[<span class="dv">2</span>] <span class="co"># beta coefficient</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">logit</span>(predictor, a, b)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">&lt;-</span> <span class="fu">sum</span>( outcome <span class="sc">*</span> <span class="fu">log</span>(p) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> outcome) <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> p))</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(ll)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can call the <code>optim</code> function and get the final parameter estimates.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>optim.binomial <span class="ot">&lt;-</span> <span class="fu">optim_save</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="co"># Initial values</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    loglikelihood.binomial,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">list</span>(<span class="at">fnscale =</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">predictor =</span> study<span class="sc">$</span>Hours,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> study<span class="sc">$</span>Pass</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In R, the <code>glm</code> (short for generalized linear models) function implements logistic regression when the <code>family = binomial(link = 'logit')</code> parameter is set. See <code>?glm</code> for other families of models to estimate models with other underlying distributions. We can see that our estimate matches the results of <code>glm</code> to a rounding error.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>optim.binomial<span class="sc">$</span>par</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -4.077575  1.504624</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>lr.out <span class="ot">&lt;-</span> <span class="fu">glm</span>(Pass <span class="sc">~</span> Hours, <span class="at">data =</span> study, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">'logit'</span>))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>lr.out<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)       Hours 
  -4.077713    1.504645 </code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Redefine the logistic function to include parameter estimates</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>logistic <span class="ot">&lt;-</span> <span class="cf">function</span>(x, beta0, beta1) {</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> (beta0 <span class="sc">+</span> beta1 <span class="sc">*</span> x)) ))</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>beta0 <span class="ot">&lt;-</span> optim.binomial<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> optim.binomial<span class="sc">$</span>par[<span class="dv">2</span>]</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(study, <span class="fu">aes</span>(<span class="at">x =</span> Hours, <span class="at">y =</span> Pass)) <span class="sc">+</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">logistic</span>(Hours, beta0, beta1) <span class="sc">&gt;</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_function</span>(<span class="at">fun =</span> logistic, <span class="at">n =</span> <span class="dv">101</span>, </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">args =</span> <span class="fu">list</span>(<span class="at">beta0 =</span> beta0, <span class="at">beta1 =</span> beta1) ) <span class="sc">+</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_hue</span>(<span class="st">'Predicted Pass &gt; 0.5'</span>) <span class="sc">+</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'inside'</span>, <span class="at">legend.position.inside =</span> <span class="fu">c</span>(<span class="fl">0.85</span>, <span class="fl">0.15</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mle_files/figure-html/mleglmplot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s explore the process of the numeric optimizer. For this model, it took 70 iterations to converge to resulting parameters.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mle_files/figure-html/mlelogiclogplot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mle_files/figure-html/mlelogiclogplot-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div id="fig-shiny-mle" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div class="figure-content">
<pre class="shinylive-r" data-engine="r"><code>#| label: fig-shiny-variance
#| viewerHeight: 600
#| standalone: true

webr::install("mnormt")
webr::install("ggplot2")
webr::install("dplyr")
webr::install("psych")
webr::install("tidyr")
webr::install("cowplot")
webr::install("reshape2")

library(ggplot2)
library(dplyr)
library(psych)
library(tidyr)
library(cowplot)
library(reshape2)

source('https://raw.githubusercontent.com/jbryer/VisualStats/main/R/isBinary.R')
source('https://raw.githubusercontent.com/jbryer/VisualStats/main/R/optim_save.R')
source('https://raw.githubusercontent.com/jbryer/VisualStats/main/R/likelihood_normal.R')
source('https://raw.githubusercontent.com/jbryer/VisualStats/main/R/likelihood_binomial.R')


source('https://raw.githubusercontent.com/jbryer/VisualStats/main/R/variance_vis.R')
source('https://raw.githubusercontent.com/jbryer/VisualStats/main/R/mle_shiny.R')

shinyApp(ui = variance_shiny_ui, server = variance_shiny_server)</code></pre>
</div>
<figcaption class="figure-caption">Figure&nbsp;5.1: Visualization of maximum likelihood estimation.</figcaption>
</figure>
</div>
<p>This Shiny application can be run locally using the <code>VisualStats::mle_shiny()</code> function.</p>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>This function is available in the <code>VisualStats</code> package.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>These data were retrived from the <a href="https://en.wikipedia.org/wiki/Logistic_regression">Wikipedia article on logistic regresion</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./loess.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Loess Regression</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./anova.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Analysis of Variance (ANOVA)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jbryer/VisualStats/edit/main/book/mle.qmd" class="toc-action">Edit this page</a></p></div></div></div></div></footer></body></html>